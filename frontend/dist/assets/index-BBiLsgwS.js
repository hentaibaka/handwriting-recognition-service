import{u as q,e as T,a as B,R as P,j as s,c as j,f as U,L as V,r as $,B as F,S as k}from"./index-DZk8EHuN.js";import{u as G}from"./useQuery-ItbA207S.js";import{r as b,O as w}from"./request-CMsvLA07.js";import{F as p,M as m,a as h,u as K,d as Q,s as H}from"./validation-CEv4JjkA.js";import{u as S}from"./useMutation-DPUchMzF.js";import{P as W,a as f}from"./PasswordComplexity-BAOJHASq.js";class z{static logoutCreate(){return b(w,{method:"POST",url:"/api/logout/"})}}class C{static profileRetrieve(){return b(w,{method:"GET",url:"/api/profile/"})}static profileChangePasswordCreate(e){return b(w,{method:"POST",url:"/api/profile/change-password/",body:e,mediaType:"application/json"})}static profileUpdateUserUpdate(e){return b(w,{method:"PUT",url:"/api/profile/update-user/",body:e,mediaType:"application/json"})}}const J=()=>{const{isAuth:a}=q(),{data:e,isLoading:n}=G({queryKey:["viewer"],queryFn:C.profileRetrieve,enabled:a});return{viewerData:{id:e==null?void 0:e.id,email:e==null?void 0:e.email,firstName:e==null?void 0:e.first_name,lastName:e==null?void 0:e.last_name,middleName:e==null?void 0:e.middle_name},isLoadingViewer:n}},X=()=>{const a=T(),{isPending:e,mutateAsync:n}=S({mutationKey:["profile-update"],mutationFn:C.profileUpdateUserUpdate}),{isPending:t,mutateAsync:o}=S({mutationFn:C.profileChangePasswordCreate});return{isProfileDataPending:e||t,updateProfileData:async r=>{await n(r),await o(r),a.invalidateQueries({queryKey:["viewer"]})}}},Y=()=>{const a=B(),{setIsAuth:e}=q(),{mutate:n,isPending:t}=S({mutationFn:z.logoutCreate,onSuccess(){e(!1),a({pathname:P.signIn})}});return{signOut:n,isSignOutPending:t}},Z=({className:a,currentPath:e,links:n})=>s.jsx("div",{className:j("font-deja-vu-sans font-extralight text-additional-color-2 text-[0.8rem] sm:text-[0.95rem] leading-[1.1rem]","flex gap-[12px]",a),children:n.map(({label:t,path:o},d)=>s.jsxs(U.Fragment,{children:[s.jsx(V,{to:{pathname:o},className:j(e===o&&"text-accent font-normal"),children:t}),n.length-1!==d&&s.jsx("span",{className:"font-inter font-light text-[0.8rem] leading-[0.96rem]",children:">"})]},o))}),i={status:{name:"status",label:"Статус"},email:{name:"email",label:"E-mail"},lastName:{name:"lastName",label:"Фамилия"},firstName:{name:"firstName",label:"Имя"},middleName:{name:"middleName",label:"Отчество"},currentPassword:{name:"currentPassword",label:"Текущий пароль"},newPassword:{name:"newPassword",label:"Новый пароль"}},ee=({className:a,control:e,disabled:n,onFieldChange:t})=>s.jsx(p,{className:a,control:e,name:i.firstName.name,label:i.firstName.label,rules:{required:"Это поле обязательное",minLength:{value:m,message:`Поле не может быть короче ${m} символов`}},disabled:n,onFieldChange:t}),se=({className:a,control:e,disabled:n,onFieldChange:t})=>s.jsx(p,{className:a,control:e,name:i.lastName.name,label:i.lastName.label,rules:{required:"Это поле обязательное",minLength:{value:m,message:`Поле не может быть короче ${m} символов`}},disabled:n,onFieldChange:t}),ae=({className:a,control:e,disabled:n,onFieldChange:t})=>s.jsx(p,{className:a,control:e,name:i.middleName.name,label:i.middleName.label,rules:{required:"Это поле обязательное",minLength:{value:m,message:`Поле не может быть короче ${m} символов`}},disabled:n,onFieldChange:t}),L=({className:a,control:e,disabled:n,onFieldChange:t})=>s.jsx(p,{className:a,control:e,name:i.email.name,label:i.email.label,rules:{required:"Это поле обязательное",minLength:{value:m,message:`Поле не может быть короче ${m} символов`}},disabled:n,onFieldChange:t}),te=({className:a,control:e,disabled:n,onFieldChange:t})=>s.jsx(p,{className:a,control:e,name:i.currentPassword.name,label:i.currentPassword.label,rules:{required:"Это поле обязательное",minLength:{value:h,message:`Пароль не может быть короче ${h} символов`}},disabled:n,onFieldChange:t}),ne=({className:a,control:e,disabled:n,onFieldChange:t})=>s.jsx(p,{className:a,control:e,name:i.newPassword.name,label:i.newPassword.label,rules:{required:"Это поле обязательное",minLength:{value:h,message:`Пароль не может быть короче ${h} символов`}},disabled:n,onFieldChange:t}),ie=({viewerData:a,signOutButton:e})=>{const n={email:a.email||"",firstName:a.firstName||"",lastName:a.lastName||"",middleName:a.middleName||"",currentPassword:"",newPassword:"",status:""},{control:t,handleSubmit:o,getValues:d}=K({defaultValues:n,reValidateMode:"onChange",mode:"onChange"}),{isProfileDataPending:r,updateProfileData:M}=X(),[c,O]=$.useState({minPasswordLength:!1,notIncludeNameAndEmail:!0,containsNumberOrSymbol:!1,passwordStrength:"Слабая"}),E=l=>{const u=l.length>=h,x=d(i.email.name),g=d(i.firstName.name),N=!!x&&l.includes(x),A=!!g&&l.includes(g),_=!N&&!A,I=Q.test(l),D=H.test(l);return{isMatchPasswordLength:u,isMatchNotIncludeNameAndEmail:_,isMatchContainsNumberOrSymbol:I||D}},v=l=>{const{isMatchContainsNumberOrSymbol:u,isMatchNotIncludeNameAndEmail:x,isMatchPasswordLength:g}=E(l),N=[g,x,u].filter(Boolean).length;O({containsNumberOrSymbol:u,notIncludeNameAndEmail:x,minPasswordLength:g,passwordStrength:N<=1?"Слабая":N===2?"Нормальная":"Сильная"})},y=()=>v(d(i.currentPassword.name)),R=l=>{const u={email:l.email,first_name:l.firstName,last_name:l.lastName,middle_name:l.middleName,new_password:l.newPassword,old_password:l.currentPassword};M(u)};return s.jsxs("form",{onSubmit:o(R),children:[s.jsxs("div",{className:"mb-[38px] profile-page-fields-grid gap-x-[17px] gap-y-[12px] sm:gap-y-[20px] md:gap-y-[30px]",children:[s.jsx(L,{className:"xl:w-[318px] status",control:t,disabled:r,onFieldChange:y}),s.jsx(L,{className:"xl:w-[318px] email",control:t,disabled:r,onFieldChange:y}),s.jsx(se,{className:"xl:w-[318px] lastName",control:t,disabled:r}),s.jsx(ee,{className:"xl:w-[318px] firstName",control:t,disabled:r,onFieldChange:y}),s.jsx(ae,{className:"xl:w-[318px] middleName",control:t,disabled:r}),s.jsx(te,{className:"xl:w-[318px] password",control:t,disabled:r}),s.jsx(ne,{className:"xl:w-[318px] newPassword",control:t,disabled:r,onFieldChange:v}),s.jsxs(W,{className:"password-complexity",children:[s.jsx(f,{isMeetRequirements:c.passwordStrength!=="Слабая",customLabel:s.jsxs("div",{children:[s.jsx("span",{children:"Надежность пароля: "}),s.jsx("span",{className:j(c.passwordStrength==="Слабая"&&"text-error"),children:c.passwordStrength})]})}),s.jsx(f,{isMeetRequirements:c.minPasswordLength,label:"Минимум 8 символов"}),s.jsx(f,{isMeetRequirements:c.notIncludeNameAndEmail,label:"Не может содержать ваше имя или адрес электронной почты"}),s.jsx(f,{isMeetRequirements:c.containsNumberOrSymbol,label:"Содержит число или символ"})]})]}),s.jsxs("div",{className:"flex flex-wrap flex-col sm:flex-row gap-[12px] sm:gap-[20px]",children:[s.jsx(F,{type:"button",children:"История распознавания"}),s.jsx(F,{type:"submit",children:"Редактировать"}),e]})]})},le=()=>{const{isSignOutPending:a,signOut:e}=Y();return s.jsx(F,{type:"button",disabled:a,onClick:()=>e(),children:"Выйти"})},Ne=()=>{const{viewerData:a,isLoadingViewer:e}=J();return s.jsxs("div",{className:"mb-[40px]",children:[s.jsx(re,{}),s.jsx(Z,{className:"sm:mb-[29px]",currentPath:P.profile,links:oe}),s.jsxs("div",{className:"py-[30px] px-[16px] sm:py-[30px] sm:px-[50px] lg:py-[27px] lg:px-[66px]",children:[s.jsx(me,{}),e?s.jsx(ie,{viewerData:a,signOutButton:s.jsx(le,{})}):s.jsx("div",{className:"h-[300px] grid place-content-center",children:s.jsx(k,{className:"!w-16 !h-16 border-4"})})]})]})},re=()=>s.jsx("h1",{className:"mb-[16px] font-medium text-[1.2rem] sm:text-[1.875rem] leading-[2.5rem]",children:"Личный кабинет"}),me=()=>s.jsx("div",{className:j("mb-[22px] text-additional-color-2 font-medium","text-[1.1rem] md:text-[1.3rem] lg:text-[1.375rem] lg:leading-[1.75rem]"),children:"Личные данные"}),oe=[{label:"Главная",path:P.main},{label:"Личный кабинет",path:P.profile}];export{Ne as default};
