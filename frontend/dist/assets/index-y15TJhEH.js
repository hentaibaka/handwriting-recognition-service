import{j as e,B as i,c as l,f as j,D as f,y as b,z as w,A as N,E as F,F as y,I}from"./index-DLXLQF8A.js";import{F as p,M as m,a as x,u as E}from"./validation-BDX7EXPq.js";import{u as v}from"./useMutation-DgrETAV9.js";import"./utils-km2FGkQ4.js";const D=s=>e.jsxs(i,{type:"button",className:l("bg-additional-color-1 text-accent hover:bg-additional-color-1","disabled:bg-additional-color-1/80 disabled:text-accent/60"),...s,children:[e.jsx(j,{iconName:"vk-logo",className:l("mr-[10px] h-[30px] w-[30px]",s.disabled&&"opacity-60")}),"Войти через VK ID"]}),o={email:{name:"email",label:"E-mail"},password:{name:"password",label:"Пароль"}},S=({control:s,disabled:n,onFieldChange:a})=>e.jsx(p,{control:s,name:o.email.name,label:o.email.label,rules:{required:"Это поле обязательное",minLength:{value:m,message:`Поле не может быть короче ${m} символов`}},disabled:n,onFieldChange:a}),k=({control:s,disabled:n,onFieldChange:a})=>e.jsx(p,{control:s,name:o.password.name,label:o.password.label,rules:{required:"Это поле обязательное",minLength:{value:x,message:`Пароль не может быть короче ${x} символов`}},disabled:n,onFieldChange:a}),P=async()=>{const s=await fetch("http://45.12.230.37/api/get-csrf-token/",{credentials:"include"});if(!s.ok)throw new Error("Failed to fetch CSRF token");return(await s.json()).csrftoken},T=async s=>{const n=await P();if(!n)throw new Error("CSRF token is undefined");const a=await fetch("http://45.12.230.37/api/login/",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":n},body:JSON.stringify(s),credentials:"include"});if(!a.ok)throw new Error("Login failed");return await a.json()},_=()=>{const{isPending:s,mutate:n}=v({mutationFn:T,onSuccess:a=>{a.redirect_url?window.location.href=a.redirect_url:console.error("No redirect_url in response")},onError:a=>{console.error("Error during login:",a)}});return{isPending:s,signIn:n}},C={email:"",password:""},R=({className:s,renderButtonSlot:n})=>{const{control:a,handleSubmit:d}=E({defaultValues:C}),{isPending:r,signIn:g}=_(),u=c=>{const h={email:c.email,password:c.password};g(h)};return e.jsxs("form",{className:s,onSubmit:d(u),children:[e.jsxs("div",{className:l("mb-[26px] grid gap-x-[17px] gap-y-[12px] sm:gap-y-[20px] md:gap-y-[30px]","sm:grid-cols-2 xl:grid-cols-[repeat(2,_403px)]"),children:[e.jsx(S,{disabled:r,control:a}),e.jsx(k,{disabled:r,control:a})]}),e.jsxs("div",{className:"mb-[26px] flex flex-wrap gap-[23px]",children:[e.jsx(i,{className:"uppercase",disabled:r,children:"Авторизоваться"}),n==null?void 0:n({disabled:r})]})]})},t="rememberPassword",A=()=>e.jsxs("div",{className:"py-[30px] px-[16px] sm:py-[30px] sm:px-[50px] lg:py-[27px] lg:px-[66px]",children:[e.jsx(L,{}),e.jsx(R,{renderButtonSlot:({disabled:s})=>e.jsx(D,{disabled:s})}),e.jsx(q,{})]}),L=()=>e.jsx("div",{className:l("mb-[13px] text-additional-color-2 font-medium","text-[1.1rem] md:text-[1.3rem] lg:text-[1.375rem] lg:leading-[1.75rem]"),children:"Авторизация"}),q=()=>e.jsxs(f,{children:[e.jsx(b,{asChild:!0,children:e.jsx(i,{variant:"link",className:"!p-0 !py-2 !h-fit !text-[1rem]",children:"Забыли пароль?"})}),e.jsxs(w,{className:"max-w-[708px]",children:[e.jsxs(N,{children:[e.jsx(F,{children:"Забыли пароль?"}),e.jsx(y,{children:"Мы отправим вам новый пароль на вашу почту"})]}),e.jsxs("div",{className:"mb-[20px] flex flex-wrap sm:flex-nowrap items-end gap-[13px]",children:[e.jsxs("div",{className:"w-full",children:[e.jsx("label",{htmlFor:t,className:"mb-[8px] text-[0.85rem] md:text-[0.875rem] leading-[1rem] font-deja-vu-sans",children:"E-mail"}),e.jsx(I,{id:t,name:t})]}),e.jsx(i,{className:"uppercase",children:"Отправить"})]})]})]});export{A as default};
