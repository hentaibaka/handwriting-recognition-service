import{j as s,B as o,c as r,f,D as j,y as w,z as b,A as N,E as F,F as I,I as k}from"./index-CZ4baPzi.js";import{F as u,M as p,a as g,u as y}from"./validation-BEs_9Psj.js";import{u as E}from"./useMutation-DsOTVS1D.js";import"./utils-km2FGkQ4.js";const D=e=>s.jsxs(o,{type:"button",className:r("bg-additional-color-1 text-accent hover:bg-additional-color-1","disabled:bg-additional-color-1/80 disabled:text-accent/60"),...e,children:[s.jsx(f,{iconName:"vk-logo",className:r("mr-[10px] h-[30px] w-[30px]",e.disabled&&"opacity-60")}),"Войти через VK ID"]}),t={email:{name:"email",label:"E-mail"},password:{name:"password",label:"Пароль"}},S=({control:e,disabled:a,onFieldChange:n})=>s.jsx(u,{control:e,name:t.email.name,label:t.email.label,rules:{required:"Это поле обязательное",minLength:{value:p,message:`Поле не может быть короче ${p} символов`}},disabled:a,onFieldChange:n}),v=({control:e,disabled:a,onFieldChange:n})=>s.jsx(u,{control:e,name:t.password.name,label:t.password.label,rules:{required:"Это поле обязательное",minLength:{value:g,message:`Пароль не может быть короче ${g} символов`}},disabled:a,onFieldChange:n}),P=async()=>{const e=await fetch("http://45.12.230.37/api/get-csrf-token/",{credentials:"include"});if(!e.ok)throw new Error("Failed to fetch CSRF token");return(await e.json()).csrftoken},T=async e=>{const a=await P();if(!a)throw new Error("CSRF token is undefined");if(!(await fetch("http://45.12.230.37/api/login/",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":a},body:JSON.stringify(e),credentials:"include"})).ok)throw new Error("Login failed");const i=document.cookie.split(";").find(l=>l.trim().startsWith("sessionid="));if(!i)throw new Error("Session ID cookie not found");return i.split("=")[1]},C=()=>{const{isPending:e,mutate:a}=E({mutationFn:T,onSuccess:()=>{console.log("Login successful, redirecting to /admin"),window.location.href="/admin"},onError:n=>{console.error("Error during login:",n)}});return{isPending:e,signIn:a}},L={email:"",password:""},R=({className:e,renderButtonSlot:a})=>{const{control:n,handleSubmit:c}=y({defaultValues:L}),{isPending:i,signIn:m}=C(),l=x=>{const h={email:x.email,password:x.password};m(h)};return s.jsxs("form",{className:e,onSubmit:c(l),children:[s.jsxs("div",{className:r("mb-[26px] grid gap-x-[17px] gap-y-[12px] sm:gap-y-[20px] md:gap-y-[30px]","sm:grid-cols-2 xl:grid-cols-[repeat(2,_403px)]"),children:[s.jsx(S,{disabled:i,control:n}),s.jsx(v,{disabled:i,control:n})]}),s.jsxs("div",{className:"mb-[26px] flex flex-wrap gap-[23px]",children:[s.jsx(o,{className:"uppercase",disabled:i,children:"Авторизоваться"}),a==null?void 0:a({disabled:i})]})]})},d="rememberPassword",A=()=>s.jsxs("div",{className:"py-[30px] px-[16px] sm:py-[30px] sm:px-[50px] lg:py-[27px] lg:px-[66px]",children:[s.jsx(_,{}),s.jsx(R,{renderButtonSlot:({disabled:e})=>s.jsx(D,{disabled:e})}),s.jsx(q,{})]}),_=()=>s.jsx("div",{className:r("mb-[13px] text-additional-color-2 font-medium","text-[1.1rem] md:text-[1.3rem] lg:text-[1.375rem] lg:leading-[1.75rem]"),children:"Авторизация"}),q=()=>s.jsxs(j,{children:[s.jsx(w,{asChild:!0,children:s.jsx(o,{variant:"link",className:"!p-0 !py-2 !h-fit !text-[1rem]",children:"Забыли пароль?"})}),s.jsxs(b,{className:"max-w-[708px]",children:[s.jsxs(N,{children:[s.jsx(F,{children:"Забыли пароль?"}),s.jsx(I,{children:"Мы отправим вам новый пароль на вашу почту"})]}),s.jsxs("div",{className:"mb-[20px] flex flex-wrap sm:flex-nowrap items-end gap-[13px]",children:[s.jsxs("div",{className:"w-full",children:[s.jsx("label",{htmlFor:d,className:"mb-[8px] text-[0.85rem] md:text-[0.875rem] leading-[1rem] font-deja-vu-sans",children:"E-mail"}),s.jsx(k,{id:d,name:d})]}),s.jsx(o,{className:"uppercase",children:"Отправить"})]})]})]});export{A as default};
