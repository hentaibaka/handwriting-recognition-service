import{r as l,h as C,g as T,j as e,c as v,B as w,I as D,S as B}from"./index-p7H9IJxa.js";import{C as h}from"./Card-BgWcEVPY.js";import{r as S,O as N}from"./request-CHWoY4Yq.js";import{u as P}from"./useQuery-jO4vLUZB.js";import{u as k}from"./useMutation-BY5_vBK1.js";class E{static demodocsList(){return S(N,{method:"GET",url:"/api/demodocs/"})}static demodocsPdfFileRetrieve(n){return S(N,{method:"GET",url:"/api/demodocs/{page_id}/pdf-file/",path:{page_id:n}})}static demodocsTextFileRetrieve(n){return S(N,{method:"GET",url:"/api/demodocs/{page_id}/text-file/",path:{page_id:n}})}}class U{static recognizeCreate(n){return S(N,{method:"POST",url:"/api/recognize/",formData:n,mediaType:"multipart/form-data"})}}const W=()=>{const t=typeof window<"u",n=()=>{const s=t?window.innerWidth:null,r=t?window.innerHeight:null;return{width:s,height:r}},[i,o]=l.useState(n());return l.useEffect(()=>{if(t){const s=()=>{o(n())};return window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)}},[t]),i},R=188,I=()=>{const[t,n]=l.useState(void 0),[i,o]=l.useState(!1),[s,r]=l.useState(!1),a=l.useRef(null),d=l.useRef(null),c=l.useRef(null),{width:u}=W(),j=u?u>=1024:!1,F=()=>{a.current&&(a.current.style.scrollBehavior="smooth",a.current.scrollLeft+=R)},y=()=>{a.current&&(a.current.style.scrollBehavior="smooth",a.current.scrollLeft-=R)},L=()=>{if(!a.current)return;const p=a.current.clientWidth,m=Math.floor(p/R),g=m*R,x=p-g,f=m-1>1?m-1:m,b=x/f;n(b)};return l.useEffect(()=>{j?L():n(void 0)},[u,j]),l.useEffect(()=>{const p=new IntersectionObserver(m=>{m.forEach(g=>{g.isIntersecting?o(!0):o(!1)})},{root:a.current,rootMargin:"100px 0px"});return d.current&&p.observe(d.current),()=>{d.current&&p.unobserve(d.current)}},[d]),l.useEffect(()=>{const p=new IntersectionObserver(m=>{m.forEach(g=>{g.isIntersecting?r(!0):r(!1)})},{root:a.current,rootMargin:"100px 0px",threshold:1});return c.current&&p.observe(c.current),()=>{c.current&&p.unobserve(c.current)}},[c]),{containerRef:a,elementsGap:t,firstElementRef:d,lastElementRef:c,handleSlideLeft:y,handleSlideRight:F,isDisableSlideLeft:i,isDisableSlideRight:s}},O=()=>{const{data:t,isLoading:n}=P({queryKey:["demodocs"],queryFn:E.demodocsList});return{demoDocs:t,isDemoDocsLoading:n}},G=({onSuccess:t})=>{const{isPending:n,mutate:i}=k({mutationFn:o=>U.recognizeCreate(o),onSuccess:t});return{sendFileForRecognition:i,isRecognitionPending:n}},z=()=>{const[t,n]=l.useState(null),[i,o]=l.useState(null),r=C().state,{isRecognitionPending:a,sendFileForRecognition:d}=G({onSuccess:({text:u})=>{if(!i||!u)return;const j=URL.createObjectURL(i);n({id:null,imageUrl:j,text:u})}}),c=async u=>{o(u),d({image:u})};return l.useEffect(()=>{r&&(c(r.recognitionFiles[0]),window.history.replaceState({},""))},[]),{selectedRecognitionFile:t,setSelectedRecognitionFile:n,isRecognitionPending:a,handleFileUpload:c}},$=()=>{const[t,n]=l.useState(!1);return{isLoading:t,getTxtBlobData:async o=>{n(!0);const s=await E.demodocsTextFileRetrieve(o);return n(!1),new Blob([s])}}},H=({className:t,buttonSlot:n,demoDocs:i=[],isLoading:o,selectedFile:s,setSelectedFile:r,...a})=>{const{containerRef:d,firstElementRef:c,lastElementRef:u,isDisableSlideLeft:j,isDisableSlideRight:F,elementsGap:y,handleSlideLeft:L,handleSlideRight:p}=I(),m=x=>{const f=i.find(({name:b})=>b===x);f&&r({id:f.id,name:f.name,imageUrl:`http://45.12.230.37${f.url}`,text:f.text})},g=x=>x===0?c:x===i.length-1?u:void 0;return e.jsxs("div",{className:v("recognition-slider",t),...a,children:[e.jsx("div",{ref:d,className:"recognition-slide-list pt-[5px] pb-[25px] px-[5px] gap-[10px]",style:{gap:y},children:o?e.jsx(_,{}):i==null?void 0:i.map(({name:x,url:f},b)=>e.jsx(M,{ref:g(b),image:`http://45.12.230.37${f}`,title:x,isSelected:(s==null?void 0:s.name)===x,onClick:()=>m(x)},x))}),e.jsxs("div",{className:"flex flex-wrap gap-[20px] ",children:[n,e.jsxs("div",{className:"flex gap-[7px]",children:[e.jsx(w,{className:"max-h-[53px] w-[53px] font-inter",disabled:j||o,onClick:L,children:e.jsx(D,{iconName:"caretLeft"})}),e.jsx(w,{className:"max-h-[53px] w-[53px] font-inter",disabled:F||o,onClick:p,children:e.jsx(D,{iconName:"caretRight"})})]})]})]})},M=T.forwardRef(({image:t,title:n,isSelected:i,...o},s)=>e.jsx("div",{ref:s,className:"recognition-slide py-[2px] px-[4px] w-[188px]",...o,children:e.jsx(h,{className:v("p-[10px] h-full rounded-[10px] hover:ring hover:ring-accent/70 duration-100 select-none",i&&"ring ring-accent/40"),children:e.jsxs("div",{className:"w-[160px]",children:[e.jsx("img",{className:"mb-[13px] h-[210px] w-full object-fill pointer-events-none",src:t,alt:n}),e.jsx("div",{className:"text-accent text-[0.75rem] leading-[1rem]",children:n})]})})})),_=()=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"min-w-[188px] h-[259px] py-[2px] px-[4px]",children:e.jsx(h,{className:"rounded-[10px] h-full animate-pulse bg-neutral-100"})}),e.jsx("div",{className:"min-w-[188px] h-[259px] py-[2px] px-[4px]",children:e.jsx(h,{className:"rounded-[10px] h-full animate-pulse bg-neutral-100"})}),e.jsx("div",{className:"min-w-[188px] h-[259px] py-[2px] px-[4px]",children:e.jsx(h,{className:"rounded-[10px] h-full animate-pulse bg-neutral-100"})}),e.jsx("div",{className:"min-w-[188px] h-[259px] py-[2px] px-[4px]",children:e.jsx(h,{className:"rounded-[10px] h-full animate-pulse bg-neutral-100"})}),e.jsx("div",{className:"min-w-[188px] h-[259px] py-[2px] px-[4px]",children:e.jsx(h,{className:"rounded-[10px] h-full animate-pulse bg-neutral-100"})}),e.jsx("div",{className:"min-w-[188px] h-[259px] py-[2px] px-[4px]",children:e.jsx(h,{className:"rounded-[10px] h-full animate-pulse bg-neutral-100"})})]}),q=({className:t,fileImage:n,text:i,buttonsSlot:o,...s})=>{const[r,a]=l.useState(null),d=l.useRef(null);return l.useEffect(()=>{setTimeout(()=>{var c;return a(((c=d.current)==null?void 0:c.clientHeight)||null)},300)},[n,i]),e.jsxs("div",{className:v("grid lg:grid-cols-2 gap-[34px]",t),...s,children:[e.jsx("div",{ref:d,className:v("h-fit rounded-[11px] grid place-items-center bg-additional-color-2","p-[12px] sm:p-[22px] md:p-[40px] lg:p-[60px]"),children:n&&e.jsx("img",{className:"w-full object-contain",src:n,alt:"Выбранный документ"})}),e.jsxs(h,{className:"p-[20px] md:py-[27px] md:px-[40px] flex flex-col",style:{height:r||void 0},children:[e.jsx("div",{className:"mb-[9px] h-full overflow-auto flex-grow font-deja-vu-sans font-extralight text-[1.125rem] leading-[1.35rem]",children:i}),e.jsx("div",{className:"flex justify-center gap-3",children:o})]})]})},A=({onFileUpload:t})=>{const n=l.useRef(null),i=s=>{if(s.target.files){const r=s.target.files[0];t(r),n.current&&(n.current.value="")}},o=()=>{var s;return(s=n.current)==null?void 0:s.click()};return e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"max-h-[53px]",onClick:o,children:"Распознать изображение"}),e.jsx("input",{ref:n,className:"hidden",type:"file",accept:"image/*",multiple:!1,onChange:i})]})},X=()=>{const[t,n]=l.useState(!1);return{isLoading:t,getPdfBlobData:async o=>{n(!0);const s=await E.demodocsPdfFileRetrieve(o);return n(!1),new Blob([s])}}},K=({fileId:t})=>{const{isLoading:n,getPdfBlobData:i}=X(),o=async()=>{if(!t)return;const s=await i(t);if(!s)return;const r=window.URL.createObjectURL(s),a=document.createElement("a");a.href=r,a.setAttribute("download",`Распознанный-текст-${new Date().toLocaleString()}.pdf`),document.body.appendChild(a),a.click(),a.remove()};return e.jsx(w,{className:"font-deja-vu-sans",disabled:n||!t,onClick:o,children:"Сохранить в pdf"})},Q=({fileId:t})=>{const{isLoading:n,getTxtBlobData:i}=$(),o=async()=>{if(!t)return;const s=await i(t);if(!s)return;const r=window.URL.createObjectURL(s),a=document.createElement("a");a.href=r,a.setAttribute("download",`Распознанный-текст-${new Date().toLocaleString()}.txt`),document.body.appendChild(a),a.click(),a.remove()};return e.jsx(w,{className:"font-deja-vu-sans",disabled:n||!t,onClick:o,children:"Сохранить в txt"})},ne=()=>{const{selectedRecognitionFile:t,setSelectedRecognitionFile:n,isRecognitionPending:i,handleFileUpload:o}=z(),{demoDocs:s,isDemoDocsLoading:r}=O();return e.jsxs("div",{className:"px-[6px]",children:[e.jsx(J,{}),e.jsx(h,{className:"px-[15px] py-[30px] mb-[20px]",children:e.jsx(H,{isLoading:r,selectedFile:t,setSelectedFile:n,demoDocs:s,buttonSlot:e.jsx(e.Fragment,{children:e.jsx(A,{onFileUpload:o})})})}),i?e.jsx("div",{className:"h-[250px] flex justify-center items-center",children:e.jsx(B,{className:"!w-16 !h-16 border-4"})}):e.jsx(e.Fragment,{children:t?e.jsx(q,{className:"mb-[36px]",fileImage:t==null?void 0:t.imageUrl,text:t==null?void 0:t.text,buttonsSlot:e.jsxs(e.Fragment,{children:[e.jsx(Q,{fileId:t.id}),e.jsx(K,{fileId:t.id})]})}):e.jsx("div",{className:"h-[100px] flex justify-center items-center text-[1.2rem]",children:"Выберите файл для распознавания"})})]})},J=()=>e.jsxs("div",{className:"mt-[10px] mb-[51px] lg:w-[800px] mx-auto",children:[e.jsxs("h2",{className:v("mb-[10px] uppercase text-center text-additional-color-3 font-medium ","sm:text-[1.2rem] lg:text-[1.875rem] lg:leading-[2.5rem]"),children:["Сервис преобразования рукописного текста в"," ",e.jsx("span",{className:"font-semibold text-accent",children:"цифровой формат"})]}),e.jsx("h3",{className:v("font-deja-vu-sans font-normal text-additional-color-7 text-center","md:text-[1.2rem] lg:text-[1.5rem] lg:leading-[1.75rem]"),children:"Выберите файлы для сканирования"})]});export{ne as default};
