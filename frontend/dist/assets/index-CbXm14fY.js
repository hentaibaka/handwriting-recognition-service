import{d as E,e as U,f as V,u as O,R as N,j as s,c as F,g as $,L as K,r as R,B as C,S as k}from"./index-p7H9IJxa.js";import{u as G}from"./useQuery-jO4vLUZB.js";import{r as j,O as y}from"./request-CHWoY4Yq.js";import{F as x,M as d,a as b,u as Q,d as H,s as W}from"./validation-Eb4fYfVm.js";import{P as z,a as P}from"./PasswordComplexity-aIPHZdOX.js";import{u as v}from"./useMutation-BY5_vBK1.js";class J{static logoutCreate(){return j(y,{method:"POST",url:"/api/logout/"})}}class L{static profileRetrieve(){return j(y,{method:"GET",url:"/api/profile/"})}static profileChangePasswordCreate(e){return j(y,{method:"POST",url:"/api/profile/change-password/",body:e,mediaType:"application/json"})}static profileUpdateUserUpdate(e){return j(y,{method:"PUT",url:"/api/profile/update-user/",body:e,mediaType:"application/json"})}}const X=()=>{const{isAuth:a}=E(),{data:e,isLoading:n}=G({queryKey:["viewer"],queryFn:L.profileRetrieve,enabled:a});return{viewerData:{id:e==null?void 0:e.id,email:e==null?void 0:e.email,firstName:e==null?void 0:e.first_name,lastName:e==null?void 0:e.last_name,middleName:e==null?void 0:e.middle_name},isLoadingViewer:n}},Y=()=>{const a=U(),{toast:e}=V(),{isPending:n,mutateAsync:t}=v({mutationKey:["profile-update"],mutationFn:L.profileUpdateUserUpdate,onError:o=>{const i=o;i.body||console.error(o);for(const g in i.body)e({title:"Ошибка обновления профиля",description:i.body[g]||"Неизвестная ошибка"})}}),{isPending:c,mutateAsync:u}=v({mutationFn:L.profileChangePasswordCreate,onError:o=>{const i=o;i.body||console.error(o);for(const g in i.body)e({title:"Ошибка обновления профиля",description:i.body[g]||"Неизвестная ошибка"})}});return{isProfileDataPending:n||c,updateProfileData:async o=>{await t(o),await u(o),a.invalidateQueries({queryKey:["viewer"]})}}},Z=()=>{const a=O(),{setIsAuth:e}=E(),{mutate:n,isPending:t}=v({mutationFn:J.logoutCreate,onSuccess(){e(!1),a({pathname:N.signIn})}});return{signOut:n,isSignOutPending:t}},ee=({className:a,currentPath:e,links:n})=>s.jsx("div",{className:F("font-deja-vu-sans font-extralight text-additional-color-2 text-[0.8rem] sm:text-[0.95rem] leading-[1.1rem]","flex gap-[12px]",a),children:n.map(({label:t,path:c},u)=>s.jsxs($.Fragment,{children:[s.jsx(K,{to:{pathname:c},className:F(e===c&&"text-accent font-normal"),children:t}),n.length-1!==u&&s.jsx("span",{className:"font-inter font-light text-[0.8rem] leading-[0.96rem]",children:">"})]},c))}),r={status:{name:"status",label:"Статус"},email:{name:"email",label:"E-mail"},lastName:{name:"lastName",label:"Фамилия"},firstName:{name:"firstName",label:"Имя"},middleName:{name:"middleName",label:"Отчество"},currentPassword:{name:"currentPassword",label:"Текущий пароль"},newPassword:{name:"newPassword",label:"Новый пароль"}},se=({className:a,control:e,disabled:n,onFieldChange:t})=>s.jsx(x,{className:a,control:e,name:r.firstName.name,label:r.firstName.label,rules:{required:"Это поле обязательное",minLength:{value:d,message:`Поле не может быть короче ${d} символов`}},disabled:n,onFieldChange:t}),ae=({className:a,control:e,disabled:n,onFieldChange:t})=>s.jsx(x,{className:a,control:e,name:r.lastName.name,label:r.lastName.label,rules:{required:"Это поле обязательное",minLength:{value:d,message:`Поле не может быть короче ${d} символов`}},disabled:n,onFieldChange:t}),te=({className:a,control:e,disabled:n,onFieldChange:t})=>s.jsx(x,{className:a,control:e,name:r.middleName.name,label:r.middleName.label,rules:{required:"Это поле обязательное",minLength:{value:d,message:`Поле не может быть короче ${d} символов`}},disabled:n,onFieldChange:t}),M=({className:a,control:e,disabled:n,onFieldChange:t})=>s.jsx(x,{className:a,control:e,name:r.email.name,label:r.email.label,rules:{required:"Это поле обязательное",minLength:{value:d,message:`Поле не может быть короче ${d} символов`}},disabled:n,onFieldChange:t}),ne=({className:a,control:e,disabled:n,onFieldChange:t})=>s.jsx(x,{className:a,control:e,name:r.currentPassword.name,label:r.currentPassword.label,rules:{required:"Это поле обязательное",minLength:{value:b,message:`Пароль не может быть короче ${b} символов`}},disabled:n,onFieldChange:t}),re=({className:a,control:e,disabled:n,onFieldChange:t})=>s.jsx(x,{className:a,control:e,name:r.newPassword.name,label:r.newPassword.label,rules:{required:"Это поле обязательное",minLength:{value:b,message:`Пароль не может быть короче ${b} символов`}},disabled:n,onFieldChange:t}),ie=({viewerData:a,signOutButton:e})=>{const n={email:a.email||"",firstName:a.firstName||"",lastName:a.lastName||"",middleName:a.middleName||"",currentPassword:"",newPassword:"",status:""},{control:t,handleSubmit:c,getValues:u}=Q({defaultValues:n,reValidateMode:"onChange",mode:"onChange"}),{isProfileDataPending:m,updateProfileData:o}=Y(),[i,g]=R.useState({minPasswordLength:!1,notIncludeNameAndEmail:!0,containsNumberOrSymbol:!1,passwordStrength:"Слабая"}),A=l=>{const p=l.length>=b,h=u(r.email.name),f=u(r.firstName.name),w=!!h&&l.includes(h),_=!!f&&l.includes(f),T=!w&&!_,D=H.test(l),B=W.test(l);return{isMatchPasswordLength:p,isMatchNotIncludeNameAndEmail:T,isMatchContainsNumberOrSymbol:D||B}},q=l=>{const{isMatchContainsNumberOrSymbol:p,isMatchNotIncludeNameAndEmail:h,isMatchPasswordLength:f}=A(l),w=[f,h,p].filter(Boolean).length;g({containsNumberOrSymbol:p,notIncludeNameAndEmail:h,minPasswordLength:f,passwordStrength:w<=1?"Слабая":w===2?"Нормальная":"Сильная"})},S=()=>q(u(r.currentPassword.name)),I=l=>{const p={email:l.email,first_name:l.firstName,last_name:l.lastName,middle_name:l.middleName,new_password:l.newPassword,old_password:l.currentPassword};o(p)};return s.jsxs("form",{onSubmit:c(I),children:[s.jsxs("div",{className:"mb-[38px] profile-page-fields-grid gap-x-[17px] gap-y-[12px] sm:gap-y-[20px] md:gap-y-[30px]",children:[s.jsx(M,{className:"xl:w-[318px] status",control:t,disabled:m,onFieldChange:S}),s.jsx(M,{className:"xl:w-[318px] email",control:t,disabled:m,onFieldChange:S}),s.jsx(ae,{className:"xl:w-[318px] lastName",control:t,disabled:m}),s.jsx(se,{className:"xl:w-[318px] firstName",control:t,disabled:m,onFieldChange:S}),s.jsx(te,{className:"xl:w-[318px] middleName",control:t,disabled:m}),s.jsx(ne,{className:"xl:w-[318px] password",control:t,disabled:m}),s.jsx(re,{className:"xl:w-[318px] newPassword",control:t,disabled:m,onFieldChange:q}),s.jsxs(z,{className:"password-complexity",children:[s.jsx(P,{isMeetRequirements:i.passwordStrength!=="Слабая",customLabel:s.jsxs("div",{children:[s.jsx("span",{children:"Надежность пароля: "}),s.jsx("span",{className:F(i.passwordStrength==="Слабая"&&"text-error"),children:i.passwordStrength})]})}),s.jsx(P,{isMeetRequirements:i.minPasswordLength,label:"Минимум 8 символов"}),s.jsx(P,{isMeetRequirements:i.notIncludeNameAndEmail,label:"Не может содержать ваше имя или адрес электронной почты"}),s.jsx(P,{isMeetRequirements:i.containsNumberOrSymbol,label:"Содержит число или символ"})]})]}),s.jsxs("div",{className:"flex flex-wrap flex-col sm:flex-row gap-[12px] sm:gap-[20px]",children:[s.jsx(C,{type:"button",children:"История распознавания"}),s.jsx(C,{type:"submit",children:"Редактировать"}),e]})]})},le=()=>{const{isSignOutPending:a,signOut:e}=Z();return s.jsx(C,{type:"button",disabled:a,onClick:()=>e(),children:"Выйти"})},Ne=()=>{const{viewerData:a,isLoadingViewer:e}=X(),{isAuth:n}=E(),t=O();return R.useEffect(()=>{n||t({pathname:N.signIn})},[n,t]),s.jsxs("div",{className:"mb-[40px]",children:[s.jsx(oe,{}),s.jsx(ee,{className:"sm:mb-[29px]",currentPath:N.profile,links:de}),s.jsxs("div",{className:"py-[30px] px-[16px] sm:py-[30px] sm:px-[50px] lg:py-[27px] lg:px-[66px]",children:[s.jsx(me,{}),e?s.jsx("div",{className:"h-[300px] grid place-content-center",children:s.jsx(k,{className:"!w-16 !h-16 border-4"})}):s.jsx(ie,{viewerData:a,signOutButton:s.jsx(le,{})})]})]})},oe=()=>s.jsx("h1",{className:"mb-[16px] font-medium text-[1.2rem] sm:text-[1.875rem] leading-[2.5rem]",children:"Личный кабинет"}),me=()=>s.jsx("div",{className:F("mb-[22px] text-additional-color-2 font-medium","text-[1.1rem] md:text-[1.3rem] lg:text-[1.375rem] lg:leading-[1.75rem]"),children:"Личные данные"}),de=[{label:"Главная",path:N.main},{label:"Личный кабинет",path:N.profile}];export{Ne as default};
