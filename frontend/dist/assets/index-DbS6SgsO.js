import{r as a,e as L,d as D,j as e,c as v,B as w,f as y,S as W}from"./index-DLXLQF8A.js";import{r as E,O as C,u as I,C as h}from"./Card-DjPC_YFF.js";import{u as U}from"./useMutation-DgrETAV9.js";import"./utils-km2FGkQ4.js";class k{static demodocsList(){return E(C,{method:"GET",url:"/api/demodocs/"})}}class O{static recognizeCreate(n){return E(C,{method:"POST",url:"/api/recognize/",formData:n,mediaType:"multipart/form-data"})}}const P=()=>{const t=typeof window<"u",n=()=>{const i=t?window.innerWidth:null,c=t?window.innerHeight:null;return{width:i,height:c}},[s,l]=a.useState(n());return a.useEffect(()=>{if(t){const i=()=>{l(n())};return window.addEventListener("resize",i),()=>window.removeEventListener("resize",i)}},[t]),s},R=188,z=()=>{const[t,n]=a.useState(void 0),[s,l]=a.useState(!1),[i,c]=a.useState(!1),r=a.useRef(null),o=a.useRef(null),d=a.useRef(null),{width:x}=P(),j=x?x>=1024:!1,b=()=>{r.current&&(r.current.style.scrollBehavior="smooth",r.current.scrollLeft+=R)},S=()=>{r.current&&(r.current.style.scrollBehavior="smooth",r.current.scrollLeft-=R)},F=()=>{if(!r.current)return;const p=r.current.clientWidth,m=Math.floor(p/R),g=m*R,u=p-g,f=m-1>1?m-1:m,N=u/f;n(N)};return a.useEffect(()=>{j?F():n(void 0)},[x,j]),a.useEffect(()=>{const p=new IntersectionObserver(m=>{m.forEach(g=>{g.isIntersecting?l(!0):l(!1)})},{root:r.current,rootMargin:"100px 0px"});return o.current&&p.observe(o.current),()=>{o.current&&p.unobserve(o.current)}},[o]),a.useEffect(()=>{const p=new IntersectionObserver(m=>{m.forEach(g=>{g.isIntersecting?c(!0):c(!1)})},{root:r.current,rootMargin:"100px 0px",threshold:1});return d.current&&p.observe(d.current),()=>{d.current&&p.unobserve(d.current)}},[d]),{containerRef:r,elementsGap:t,firstElementRef:o,lastElementRef:d,handleSlideLeft:S,handleSlideRight:b,isDisableSlideLeft:s,isDisableSlideRight:i}},G=()=>{const{data:t,isLoading:n}=I({queryKey:["demodocs"],queryFn:k.demodocsList});return{demoDocs:t,isDemoDocsLoading:n}},B=({onSuccess:t})=>{const{isPending:n,mutate:s}=U({mutationFn:l=>O.recognizeCreate(l),onSuccess:t});return{sendFileForRecognition:s,isRecognitionPending:n}},H=()=>{const[t,n]=a.useState(null),[s,l]=a.useState(null),c=L().state,{isRecognitionPending:r,sendFileForRecognition:o}=B({onSuccess:({text:x})=>{if(!s||!x)return;const j=URL.createObjectURL(s);n({imageUrl:j,text:x})}}),d=async x=>{l(x),o({image:x})};return a.useEffect(()=>{c&&(d(c.recognitionFiles[0]),window.history.replaceState({},""))},[]),{selectedRecognitionFile:t,setSelectedRecognitionFile:n,isRecognitionPending:r,handleFileUpload:d}},T=({className:t,buttonSlot:n,demoDocs:s=[],isLoading:l,selectedFile:i,setSelectedFile:c,...r})=>{const{containerRef:o,firstElementRef:d,lastElementRef:x,isDisableSlideLeft:j,isDisableSlideRight:b,elementsGap:S,handleSlideLeft:F,handleSlideRight:p}=z(),m=u=>{const f=s.find(({name:N})=>N===u);f&&c({name:f.name,imageUrl:`http://45.12.230.37${f.url}`,text:f.text})},g=u=>u===0?d:u===s.length-1?x:void 0;return e.jsxs("div",{className:v("recognition-slider",t),...r,children:[e.jsx("div",{ref:o,className:"recognition-slide-list pt-[5px] pb-[25px] px-[5px] gap-[10px]",style:{gap:S},children:l?e.jsx($,{}):s==null?void 0:s.map(({name:u,url:f},N)=>e.jsx(M,{ref:g(N),image:`http://45.12.230.37${f}`,title:u,isSelected:(i==null?void 0:i.name)===u,onClick:()=>m(u)},u))}),e.jsxs("div",{className:"flex flex-wrap gap-[20px] ",children:[n,e.jsxs("div",{className:"flex gap-[7px]",children:[e.jsx(w,{className:"max-h-[53px] w-[53px] font-inter",disabled:j||l,onClick:F,children:e.jsx(y,{iconName:"caretLeft"})}),e.jsx(w,{className:"max-h-[53px] w-[53px] font-inter",disabled:b||l,onClick:p,children:e.jsx(y,{iconName:"caretRight"})})]})]})]})},M=D.forwardRef(({image:t,title:n,isSelected:s,...l},i)=>e.jsx("div",{ref:i,className:"recognition-slide py-[2px] px-[4px] w-[188px]",...l,children:e.jsx(h,{className:v("p-[10px] h-full rounded-[10px] hover:ring hover:ring-accent/70 duration-100 select-none",s&&"ring ring-accent/40"),children:e.jsxs("div",{className:"w-[160px]",children:[e.jsx("img",{className:"mb-[13px] h-[210px] w-full object-fill pointer-events-none",src:t,alt:n}),e.jsx("div",{className:"text-accent text-[0.75rem] leading-[1rem]",children:n})]})})})),$=()=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"min-w-[188px] h-[259px] py-[2px] px-[4px]",children:e.jsx(h,{className:"rounded-[10px] h-full animate-pulse bg-neutral-100"})}),e.jsx("div",{className:"min-w-[188px] h-[259px] py-[2px] px-[4px]",children:e.jsx(h,{className:"rounded-[10px] h-full animate-pulse bg-neutral-100"})}),e.jsx("div",{className:"min-w-[188px] h-[259px] py-[2px] px-[4px]",children:e.jsx(h,{className:"rounded-[10px] h-full animate-pulse bg-neutral-100"})}),e.jsx("div",{className:"min-w-[188px] h-[259px] py-[2px] px-[4px]",children:e.jsx(h,{className:"rounded-[10px] h-full animate-pulse bg-neutral-100"})}),e.jsx("div",{className:"min-w-[188px] h-[259px] py-[2px] px-[4px]",children:e.jsx(h,{className:"rounded-[10px] h-full animate-pulse bg-neutral-100"})}),e.jsx("div",{className:"min-w-[188px] h-[259px] py-[2px] px-[4px]",children:e.jsx(h,{className:"rounded-[10px] h-full animate-pulse bg-neutral-100"})})]}),q=({className:t,fileImage:n,text:s,...l})=>{const[i,c]=a.useState(null),r=a.useRef(null);return console.log(s),a.useEffect(()=>{setTimeout(()=>{var o;return c(((o=r.current)==null?void 0:o.clientHeight)||null)},300)},[n,s]),e.jsxs("div",{className:v("grid lg:grid-cols-2 gap-[34px]",t),...l,children:[e.jsx("div",{ref:r,className:v("h-fit rounded-[11px] grid place-items-center bg-additional-color-2","p-[12px] sm:p-[22px] md:p-[40px] lg:p-[60px]"),children:n&&e.jsx("img",{className:"w-full object-contain",src:n,alt:"Выбранный документ"})}),e.jsxs(h,{className:"p-[20px] md:py-[27px] md:px-[40px] flex flex-col",style:{height:i||void 0},children:[e.jsx("div",{className:"mb-[9px] h-full overflow-auto flex-grow font-deja-vu-sans font-extralight text-[1.125rem] leading-[1.35rem]",children:s}),e.jsx("div",{className:"flex justify-center",children:e.jsx(w,{className:"font-deja-vu-sans",children:"Сохранить в txt"})})]})]})},A=({onFileUpload:t})=>{const n=a.useRef(null),s=i=>{if(i.target.files){const c=i.target.files[0];t(c),n.current&&(n.current.value="")}},l=()=>{var i;return(i=n.current)==null?void 0:i.click()};return e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"max-h-[53px]",onClick:l,children:"Распознать изображение"}),e.jsx("input",{ref:n,className:"hidden",type:"file",accept:"image/*",multiple:!1,onChange:s})]})},Y=()=>{const{selectedRecognitionFile:t,setSelectedRecognitionFile:n,isRecognitionPending:s,handleFileUpload:l}=H(),{demoDocs:i,isDemoDocsLoading:c}=G();return e.jsxs("div",{className:"px-[6px]",children:[e.jsx(K,{}),e.jsx(h,{className:"px-[15px] py-[30px] mb-[20px]",children:e.jsx(T,{isLoading:c,selectedFile:t,setSelectedFile:n,demoDocs:i,buttonSlot:e.jsx(e.Fragment,{children:e.jsx(A,{onFileUpload:l})})})}),s?e.jsx("div",{className:"h-[250px] flex justify-center items-center",children:e.jsx(W,{className:"!w-16 !h-16 border-4"})}):e.jsx(e.Fragment,{children:t?e.jsx(q,{className:"mb-[36px]",fileImage:t==null?void 0:t.imageUrl,text:t==null?void 0:t.text}):e.jsx("div",{className:"h-[100px] flex justify-center items-center text-[1.2rem]",children:"Выберите файл для распознавания"})})]})},K=()=>e.jsxs("div",{className:"mt-[10px] mb-[51px] lg:w-[800px] mx-auto",children:[e.jsxs("h2",{className:v("mb-[10px] uppercase text-center text-additional-color-3 font-medium ","sm:text-[1.2rem] lg:text-[1.875rem] lg:leading-[2.5rem]"),children:["Сервис преобразования рукописного текста в"," ",e.jsx("span",{className:"font-semibold text-accent",children:"цифровой формат"})]}),e.jsx("h3",{className:v("font-deja-vu-sans font-normal text-additional-color-7 text-center","md:text-[1.2rem] lg:text-[1.5rem] lg:leading-[1.75rem]"),children:"Выберите файлы для сканирования"})]});export{Y as default};
